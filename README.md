# Spanish Analyser

Модуль для анализа испанского языка с интеграцией Anki. Проект предоставляет инструменты для обработки испанских текстов, анализа частоты слов и работы с коллекциями Anki.

## Возможности

- **Обработка текста**: Очистка HTML тегов, удаление испанских артиклей, определение доминирующего языка
- **Анализ слов**: Подсчёт частоты, категоризация по частоте, выявление новых слов, определение частей речи с помощью spaCy
- **Интеграция с Anki**: Работа с коллекциями, поиск заметок, извлечение текста из карточек
- **Экспорт данных**: Сохранение результатов в Excel с категоризацией и частями речи
- **Веб-скрапинг**: Автоматическая загрузка тестов с practicatest.com
- **Управление файлами**: Автоматическая очистка старых результатов, ограничение по количеству файлов
- **Умное извлечение текста**: Поиск релевантных блоков HTML (col-md-8) для лучшего качества анализа

## Структура проекта

```
spanish_analyser/
├── src/
│   ├── spanish_analyser/
│   │   ├── __init__.py
│   │   ├── text_processor.py      # Обработка испанского текста
│   │   ├── anki_integration.py    # Интеграция с Anki
│   │   └── word_analyzer.py       # Анализ слов с частями речи
│   └── main.py                    # Основной скрипт
├── tools/                         # Основные инструменты
│   ├── web_scraper/               # Инструмент 1: Универсальный веб-скрапинг
│   │   ├── html_downloader.py           # Базовый загрузчик HTML
│   │   ├── scraping_manager.py          # Менеджер скрапинга
│   │   ├── driving_tests_downloader.py # Специализация для билетов
│   │   ├── practicatest_auth.py        # Модуль авторизации
│   │   ├── practicatest_parser.py      # Парсер страниц
│   │   ├── test_downloader.py          # Загрузчик тестов по датам
│   │   └── download_tests.py           # Основной скрипт загрузки
│   ├── text_analyzer/             # Инструмент 2: Текстовый анализатор
│   │   └── driving_tests_analyzer.py   # Анализатор билетов с частями речи
│   ├── main_tools.py              # Главный скрипт управления
│   └── README.md                  # Документация инструментов
├── data/                          # Данные проекта
│   ├── downloads/                 # Загруженные HTML файлы
│   └── results/                   # Результаты анализа (Excel)
├── tests/                         # Тесты
├── requirements.txt               # Зависимости Python
├── setup.py                      # Установка модуля
└── README.md                     # Документация
```

## Требования

- Python 3.8 или выше
- Anki (для интеграции с коллекциями)

## Установка

1. **Клонируйте репозиторий:**
```bash
git clone https://github.com/your-username/spanish_analyser.git
cd spanish_analyser
```

2. **Создайте виртуальное окружение:**
```bash
python -m venv venv
source venv/bin/activate  # На macOS/Linux
# или
venv\Scripts\activate     # На Windows
```

3. **Установите зависимости:**
```bash
pip install -r requirements.txt
```

4. **Настройте конфигурацию:**
   - Скопируйте `.env_example` в `.env` и заполните своими данными
   - При необходимости отредактируйте `config.yaml` для изменения настроек проекта

5. **Установите модель spaCy для испанского языка:**
```bash
python -m spacy download es_core_news_md
```

## Конфигурация

Проект использует два конфигурационных файла:

### `config.yaml` - Основные настройки проекта
Содержит все настройки проекта (кроме паролей и API ключей):
- **anki** - настройки интеграции с Anki (путь к коллекции, паттерн колод, поля)
- **text_analysis** - настройки анализа текста (модель spaCy, минимальная длина слов)
- **web_scraper** - настройки веб-скрапера (URL, таймауты, User-Agent)
- **files** - настройки файлов (папки загрузок, результатов, префиксы)
- **excel** - настройки Excel экспорта (формат частоты, названия листов)
- **logging** - настройки логирования (уровень, формат, файлы)

### `.env` - Секретные данные
Содержит только пароли, API ключи и другие секретные данные:
- `PRACTICATEST_EMAIL` - email для входа на practicatest.com
- `PRACTICATEST_PASSWORD` - пароль для входа на practicatest.com
- `OPENAI_API_KEY` - API ключ OpenAI (если используется)

**Важно:** Файл `.env` НЕ должен попадать в git репозиторий!

## Использование

### Основные инструменты

Проект предоставляет единый интерфейс для всех инструментов:

```bash
# Запуск веб-скрапера для загрузки тестов
python tools/main_tools.py --scraper

# Запуск текстового анализатора
python tools/main_tools.py --analyzer

# Запуск всех инструментов
python tools/main_tools.py --all

# Интерактивный режим
python tools/main_tools.py
```

### Веб-скрапер (Инструмент 1)

Автоматическая загрузка тестов с practicatest.com:

```bash
cd tools/web_scraper
python download_tests.py
```

**Возможности:**
- Авторизация на practicatest.com
- Анализ таблицы доступных тестов
- Автоматическая загрузка новых тестов
- Проверка уже загруженных тестов
- Очистка HTML от изображений

### Текстовый анализатор (Инструмент 2)

Анализ загруженных HTML файлов и создание Excel отчётов:

```bash
cd tools/text_analyzer
python driving_tests_analyzer.py
```

**Возможности:**
- **Умное извлечение текста** из HTML файлов с поиском блоков `col-md-8`
- **Нормализация испанских слов** с помощью spaCy
- **Точное определение частей речи** с использованием модели `es_core_news_md`
- **Лемматизация слов** для лучшего качества анализа
- **Проверка слов против колоды Spanish в Anki**
- **Создание Excel отчётов** с временными метками
- **Автоматическая очистка старых файлов** (максимум 20)

**Технологии:**
- **spaCy** - профессиональная библиотека для NLP
- **Испанская модель** `es_core_news_md` для точного анализа
- **Fallback механизм** - базовое определение частей речи если spaCy недоступен

**Формат названий файлов результатов:**
```
driving_tests_analysis_YYYYMMDD_HHMMSS.xlsx
```

**Структура Excel файла:**

Excel файл содержит один лист "Word Analysis" с колонками:
- **Word** - слово на испанском языке
- **Part of Speech** - часть речи на русском языке (определяется spaCy)
- **Frequency** - относительная частота в процентах от общего количества слов
- **Count** - абсолютное количество вхождений слова

### Базовый анализ текста

```
```